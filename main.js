(()=>{"use strict";const e=function(){let e=function(){let e=function(){let e=new Map;for(let t=0;t<10;t++)for(let o=0;o<10;o++)e.set(JSON.stringify([t,o]),{attacked:!1,occupied:!1,ship:null});return e}(),t=new Map;return{coordinates:e,placeShip:function(o,n,l,r){let s=JSON.parse(n),a=JSON.parse(n),i=JSON.parse(n),c=function(e){return{hit:function(){this.hits++},isSunk:function(){return this.hits==this.length},length:e,hits:0}}(o);if(i[1]=c.length-1+s[1],i[0]=c.length-1+s[0],l&&i[1]<10){t.set(r,c),e.get(JSON.stringify(a)).occupied=!0,e.get(JSON.stringify(a)).name=r;for(let t=1;t<o;t++)a[1]++,e.get(JSON.stringify(a)).occupied=!0,e.get(JSON.stringify(a)).name=r}else if(!l&&i[0]<10){t.set(r,c),e.get(JSON.stringify(a)).occupied=!0,e.get(JSON.stringify(a)).name=r;for(let t=1;t<o;t++)a[0]++,e.get(JSON.stringify(a)).occupied=!0,e.get(JSON.stringify(a)).name=r}},shipCount:function(){return t.size},ships:t,receiveAttack:function(o){if(1==e.get(o).occupied&&0==e.get(o).attacked){e.get(o).attacked=!0;let n=e.get(o).name;t.get(n).hit(),t.get(n).isSunk()&&(t.delete(n),console.log("enemyShips",t.size))}else 0==e.get(o).occupied&&0==e.get(o).attacked&&(e.get(o).attacked=!0)}}}();const t=function(e=null,n=null,l=null){if(null!=l){let l=`[${e},${n}]`,r=o.indexOf(l);return console.log("index",r),-1==r?t():(o.splice(r,1),console.log("SPLICED!"),console.log(l),console.log(o.length),l)}if(null==l){let e=o.length;console.log("lentgh",e);let t=Math.floor(Math.random()*e),n=o[t];return console.log(n),o.splice(t,1),console.log("SPLICED!"),console.log("moves left:",o.length),n}},o=function(){let e=[];for(let t=0;t<10;t++)for(let o=0;o<10;o++){let n=[];n.push(t,o),e.push(JSON.stringify(n))}return e}();return{board:e,attack:function(e,t){null!=e.coordinates.get(t)&&e.receiveAttack(t)},computerAI:t,computerMoves:o}},t=function(e,t){const n=document.getElementById(e);o(n,t)},o=function(e,t){for(let o=9;o>-1;o--){let n=document.createElement("div");n.setAttribute("class",`row-${o}`),n.style.height="100%",n.style.display="flex",0!==o&&(n.style.borderBottom="1px solid black"),e.append(n);for(let e=0;e<10;e++){let l=document.createElement("div");l.setAttribute("class",`x${e}-${o}`),l.classList.add(t),l.addEventListener("dragover",(e=>{e.preventDefault()})),l.addEventListener("drop",(e=>{e.preventDefault(),console.log("coordinate",e.dataTransfer.getData("text/html")),e.target.classList.add("user-occupied")})),l.style.flexGrow="1",9!==e&&(l.style.borderRight="1px solid black"),n.append(l)}}},n=function(e,t,o,n){let l=e.target.className,r=l.split(" ");r=r.join("."),console.log(r);let s=`[${l.slice(1,2)},${l.slice(3,4)}]`;if(t.receiveAttack(s),console.log(t.coordinates.get(s).occupied),console.log(t.shipCount()),0==t.shipCount())document.getElementById("message").innerText="Message: You WIN",1==t.coordinates.get(s).occupied&&(document.querySelector(`.${r}`).classList.add("hit"),document.getElementById("message").innerText="Message: HIT",n.disconnect(),setTimeout((()=>document.getElementById("message").innerText="Message: You WIN"),2e3));else if(0==o.shipCount())document.getElementById("message").innerText="Message: computer WIN";else if(1==t.coordinates.get(s).occupied)document.querySelector(`.${r}`).classList.add("hit"),document.getElementById("message").innerText="Message: HIT",n.disconnect();else{for(let e=0;e<10;e++)n.observe(document.querySelector(`#map-enemy > .row-${e}`),{subtree:!0,attributes:!0});document.querySelector(`.${r}`).classList.add("miss"),document.getElementById("message").innerText="Message: MISS"}},l=async function(e,t,o=null,n=null,r=null){let s=null;function a(e){return new Promise((t=>setTimeout(t,e)))}s=null!==r?r:e(),document.querySelector(".blocker").style.display="block",await a(1e3);let i=s.split(""),c=i[1],u=i[3];"+"==o&&"v"==n?9!=u?(u++,s=e(c,u,o)):o=null:"-"==o&&"v"==n?0!=u?(u--,s=e(c,u,o)):o=null:"+"==o&&"h"==n?9!=c?(c++,s=e(c,u,o)):o=null:"-"==o&&"h"==n&&(0!=c?(c--,s=e(c,u,o)):o=null),null==o&&null!=n&&(s=e()),i=s.split(""),c=i[1],u=i[3];let d=`[${c},${u}]`;const m=document.querySelector(`.x${c}-${u}.player`);if(document.getElementById("message").innerText="Message: Computer thinking...",await a(1e3),0==t.shipCount())document.getElementById("message").innerText="Message: Computer WINS";else if(1==t.coordinates.get(d).occupied){r=d,m.classList.add("hit"),document.getElementById("message").innerText="Message: Computer HIT",t.receiveAttack(d);let s=Math.floor(10*Math.random())%2;if(null==o&&(o=0==s?"+":"-"),null==n&&(n=0==s?"v":"h",console.log(o),console.log(n)),0==t.shipCount())return void(document.getElementById("message").innerText="Message: Computer WINS");l(e,t,o,n,r)}else 0==t.coordinates.get(d).occupied&&(m.classList.add("miss"),document.getElementById("message").innerText="Message: Computer MISS");document.querySelector(".blocker").style.display="none"},r=e(),s=e();t("map-user","player"),s.board.placeShip(5,prompt("carrier: enter coorintates from 0-9 eg:[x,y]"),!0,"carrier"),s.board.placeShip(4,prompt("battleship: enter coorintates from 0-9 eg:[x,y]"),!0,"battleship"),s.board.placeShip(3,prompt("destoyer: enter coorintates from 0-9 eg:[x,y]"),!0,"destoyer"),s.board.placeShip(3,prompt("subamarine: enter coorintates from 0-9 eg:[x,y]"),!0,"subamarine"),s.board.placeShip(2,prompt("patrol boat: enter coorintates from 0-9 eg:[x,y]"),!0,"patrol boat"),function(e){for(let t=0;t<10;t++)for(let o=0;o<10;o++)1==e.coordinates.get(`[${t},${o}]`).occupied&&document.querySelector(`.x${t}-${o}.player`).classList.add("user-occupied")}(s.board),document.getElementById("wrapper-enemy").style.display="block",t("map-enemy","enemy"),r.board.placeShip(5,`[0,${Math.floor(6*Math.random())}]`,!0,"carrier"),r.board.placeShip(4,`[${1+Math.floor(3*Math.random())},${Math.floor(9*Math.random())}]`,!0,"battleship"),r.board.placeShip(3,`[5,${Math.floor(8*Math.random())}]`,!0,"destoyer"),r.board.placeShip(3,`[${6+Math.floor(3*Math.random())},${Math.floor(8*Math.random())}]`,!0,"subamarine"),r.board.placeShip(2,`[4,${Math.floor(9*Math.random())}]`,!0,"patrol boat"),console.log(r.computerMoves);const a=new MutationObserver((()=>{if(0==s.board.shipCount())console.log("DONE");else{let e=r.computerAI;r.attack(s.board,e),l(e,s.board)}}));for(let e=0;e<10;e++)a.observe(document.querySelector(`#map-enemy > .row-${e}`),{subtree:!0,attributes:!0});!function(e,t,o){for(let l=9;l>-1;l--)for(let r=0;r<10;r++)document.querySelector(`.x${l}-${r}.enemy`).addEventListener("click",(function l(r){n(r,e,t,o),this.removeEventListener("click",l)}))}(r.board,s.board,a),console.log(s.board.coordinates)})();