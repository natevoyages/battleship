(()=>{"use strict";const e=function(){let e=function(){let e=function(){let e=new Map;for(let t=0;t<10;t++)for(let o=0;o<10;o++)e.set(JSON.stringify([t,o]),{attacked:!1,occupied:!1,ship:null});return e}(),t=new Map;return{coordinates:e,placeShip:function(o,n,l,s){let r=JSON.parse(n),i=JSON.parse(n),c=JSON.parse(n),a=function(e){return{hit:function(){this.hits++},isSunk:function(){return this.hits==this.length},length:e,hits:0}}(o);if(c[1]=a.length-1+r[1],c[0]=a.length-1+r[0],l&&c[1]<10){t.set(s,a),e.get(JSON.stringify(i)).occupied=!0,e.get(JSON.stringify(i)).name=s;for(let t=1;t<o;t++)i[1]++,e.get(JSON.stringify(i)).occupied=!0,e.get(JSON.stringify(i)).name=s}else if(!l&&c[0]<10){t.set(s,a),e.get(JSON.stringify(i)).occupied=!0,e.get(JSON.stringify(i)).name=s;for(let t=1;t<o;t++)i[0]++,e.get(JSON.stringify(i)).occupied=!0,e.get(JSON.stringify(i)).name=s}},shipCount:function(){return t.size},ships:t,receiveAttack:function(o){if(1==e.get(o).occupied&&0==e.get(o).attacked){e.get(o).attacked=!0;let n=e.get(o).name;t.get(n).hit(),t.get(n).isSunk()&&(t.delete(n),console.log("enemyShips",t.size))}else 0==e.get(o).occupied&&0==e.get(o).attacked&&(e.get(o).attacked=!0)}}}();const t=function(e=null,n=null,l=null){if(null!=l){let l=`[${e},${n}]`,s=o.indexOf(l);return console.log("index",s),-1==s?t():(o.splice(s,1),console.log("SPLICED!"),console.log(l),console.log(o.length),l)}if(null==l){let e=o.length;console.log("lentgh",e);let t=Math.floor(Math.random()*e),n=o[t];return console.log(n),o.splice(t,1),console.log("SPLICED!"),console.log("moves left:",o.length),n}},o=function(){let e=[];for(let t=0;t<10;t++)for(let o=0;o<10;o++){let n=[];n.push(t,o),e.push(JSON.stringify(n))}return e}();return{board:e,attack:function(e,t){null!=e.coordinates.get(t)&&e.receiveAttack(t)},computerAI:t,computerMoves:o}},t=function(e,t){const n=document.getElementById(e);o(n,t)},o=function(e,t){for(let o=9;o>-1;o--){let n=document.createElement("div");n.setAttribute("class",`row-${o}`),n.style.height="100%",n.style.display="flex",0!==o&&(n.style.borderBottom="1px solid black"),e.append(n);for(let e=0;e<10;e++){let l=document.createElement("div");l.setAttribute("class",`x${e}-${o}`),l.classList.add(t),l.addEventListener("dragover",(e=>{e.preventDefault()})),l.addEventListener("drop",(e=>{e.preventDefault(),console.log("coordinate",e.dataTransfer.getData("text/html")),e.target.classList.add("user-occupied")})),l.style.flexGrow="1",9!==e&&(l.style.borderRight="1px solid black"),n.append(l)}}},n=function(e,t,o,n){let l=e.target.className,s=l.split(" ");s=s.join("."),console.log(s);let r=`[${l.slice(1,2)},${l.slice(3,4)}]`;if(t.receiveAttack(r),console.log(t.coordinates.get(r).occupied),console.log(t.shipCount()),0==t.shipCount())document.getElementById("message").innerText="Message: You WIN",1==t.coordinates.get(r).occupied&&(document.querySelector(`.${s}`).classList.add("hit"),document.getElementById("message").innerText="Message: HIT",n.disconnect(),setTimeout((()=>document.getElementById("message").innerText="Message: You WIN"),2e3));else if(0==o.shipCount())document.getElementById("message").innerText="Message: computer WIN";else if(1==t.coordinates.get(r).occupied)document.querySelector(`.${s}`).classList.add("hit"),document.getElementById("message").innerText="Message: HIT",n.disconnect();else{for(let e=0;e<10;e++)n.observe(document.querySelector(`#map-enemy > .row-${e}`),{subtree:!0,attributes:!0});document.querySelector(`.${s}`).classList.add("miss"),document.getElementById("message").innerText="Message: MISS"}},l=function(e,t,o=null,n=null,s=null){let r=null;function i(e){setTimeout(null,e)}r=null!==s?s:e(),document.querySelector(".blocker").style.display="block",i(0);let c=r.split(""),a=c[1],d=c[3];"+"==o&&"v"==n?9!=d?(d++,r=e(a,d,o)):o=null:"-"==o&&"v"==n?0!=d?(d--,r=e(a,d,o)):o=null:"+"==o&&"h"==n?9!=a?(a++,r=e(a,d,o)):o=null:"-"==o&&"h"==n&&(0!=a?(a--,r=e(a,d,o)):o=null),null==o&&null!=n&&(r=e()),c=r.split(""),a=c[1],d=c[3];let u=`[${a},${d}]`;const g=document.querySelector(`.x${a}-${d}.player`);if(document.getElementById("message").innerText="Message: Computer thinking...",i(0),0==t.shipCount())document.getElementById("message").innerText="Message: Computer WINS";else if(1==t.coordinates.get(u).occupied){s=u,g.classList.add("hit"),document.getElementById("message").innerText="Message: Computer HIT",t.receiveAttack(u);let r=Math.floor(10*Math.random())%2;if(null==o&&(o=0==r?"+":"-"),null==n&&(n=0==r?"v":"h",console.log(o),console.log(n)),0==t.shipCount())return void(document.getElementById("message").innerText="Message: Computer WINS");l(e,t,o,n,s)}else 0==t.coordinates.get(u).occupied&&(g.classList.add("miss"),document.getElementById("message").innerText="Message: Computer MISS");document.querySelector(".blocker").style.display="none"},s=e(),r=e();if(t("map-user","player"),r.board.placeShip(5,"[0,5]",!0,"carrier"),r.board.placeShip(4,"[1,5]",!0,"battleship"),r.board.placeShip(3,"[2,5]",!0,"destoyer"),r.board.placeShip(3,"[3,5]",!0,"subamarine"),r.board.placeShip(2,"[7,5]",!0,"patrol boat"),function(e){let t=document.querySelector("body");console.log(t);let o=document.createElement("div");o.style.border="1px solid black",t.append(o),console.log(o);for(let e=0;e<5;e++){let e=document.createElement("div");e.style.backgroundColor="blue",e.style.width="10%",e.style.flex="1",e.style.border="1px solid black",o.append(e)}o.style.height="4vh",o.style.width="20vh",o.style.display="flex",o.setAttribute("draggable","true"),o.addEventListener("dragstart",(e=>{e.dataTransfer.setData("text/html",e.target.innerHTML),document.querySelector("#message").textContent="dragging",o.childNodes.forEach((e=>e.style.backgroundColor="green"))})),o.addEventListener("dragend",(()=>{document.querySelector("#message").textContent="dragging",o.childNodes.forEach((e=>e.style.backgroundColor="blue"))}))}(),5==r.board.ships.size){document.getElementById("wrapper-enemy").style.display="block",t("map-enemy","enemy"),s.board.placeShip(5,"[0,5]",!0,"carrier"),s.board.placeShip(4,"[1,5]",!0,"battleship"),s.board.placeShip(3,"[2,5]",!0,"destoyer"),s.board.placeShip(3,"[3,5]",!0,"subamarine"),s.board.placeShip(2,"[4,5]",!0,"patrol boat"),console.log(s.computerMoves);const e=new MutationObserver((()=>{if(0==r.board.shipCount())console.log("DONE");else{let e=s.computerAI;s.attack(r.board,e),l(e,r.board)}}));for(let t=0;t<10;t++)e.observe(document.querySelector(`#map-enemy > .row-${t}`),{subtree:!0,attributes:!0});!function(e,t,o){for(let l=9;l>-1;l--)for(let s=0;s<10;s++)document.querySelector(`.x${l}-${s}.enemy`).addEventListener("click",(function l(s){n(s,e,t,o),this.removeEventListener("click",l)}))}(s.board,r.board,e)}console.log(r.board.coordinates)})();